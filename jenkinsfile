pipeline {
    agent any

  
    stages {
        
                stage('git') {
            steps {
            
                git branch: 'oussema', url: 'https://github.com/Mohamedazizgh/DevOpsSpring.git',
                credentialsId:"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";
                
            }
}
        
       stage('Maven '){
            steps {
             
               sh """mvn package -e """
	       sh """mvn compile -e """
	       sh """mvn clean -e """
            }
        }
        
      
           stage("Test unitaire"){
            steps {
                sh """mvn test  """
                
            }
        }
        
      
        stage('SonarQube analysis') {
      steps {
       
          sh "mvn clean  sonar:sonar \
           -Dsonar.projectKey=devops \
           -Dsonar.host.url=http://192.168.1.19:9000 \
           -Dsonar.login=7cffe717aaf2bf3b76ce4c910b639ff7c80f731e \
           -Dsonar.java.binaries=src/main "
        
      }
    }
   
  
           
           stage("nexus") {
        steps{
         
           sh 'mvn  deploy  -DgroupId=tn.esprit.rh -DartifactId=achat -Dversion=1.0 -DgeneratePom=true -Dpackaging=jar -DrepositoryId=deploymentRepo -Durl=http://192.168.1.19:8081/repository/maven-releases/  -Dfile=target/achat-1.0.jar'
        }
        }
         stage("Build docker image") {
        steps{
           sh ' docker build -t oussemajerfel/achat-1.0:latest .'
	   sh ' docker ps -a'
        }
        } 
           
           
           stage("login and pushing  to docker hub") {
        steps{
	
	       sh 'docker login -u oussemajerfel -p 181JMT0601 '
	       sh 'docker push --disable-content-trust oussemajerfel/achat-1.0:latest'
            
	    
        }
        }
         
     stage('DOCKER COMPOSE') {
                 steps {
		     echo " Docker Compose"
                     sh 'docker-compose up -d --build'
		     
                   }
              }
	      
	    
        
        
  


    }
      post{
        always{
            mail to: "oussemajerfel@gmail.com",
            subject: "jenkins File",
            body: "Success"
        }
    }
}
